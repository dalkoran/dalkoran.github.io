---
layout: post
title: "WinForms Animation"
date: 2007-10-24 12:42
author: spencen
comments: true
categories: [.NET, Development]
tags: []
---
<P>[<EM>This post stemmed from a conversation I had today where I was trying to preach the wonders of WPF - particularly in terms of being able to declare simple yet effective animations for UI elements. Contrasting it to what we used to have to do "when I was a lad"...</EM>]</P>
<P>A couple of months back when I was working on the WinForms version on my PhotoPlay applet I was trying to do some simple animation using WinForms (GDI+). The effect I was trying to generate was a "fade away". When a selected photo was removed (via Delete key) it was to fade to transparent and also shrink to nothingness around its centre.</P>
<P>I wanted to use a Timer to make sure that the effect always took a set amount of time, e.g. 500ms. I always use this approach because it makes sure your animations behave nicely no matter how meagre your hardware. The only other obvious approach is to animate every frame - regardless of how long in takes - I've never found this too useful.</P>
<P>So with my "fade away" animation coded up in the form I realised that I now how the need for another animation. This time when double-clicking on an image it needed to scale to full size, rotate to zero degrees and position itself in the centre of the window. Hmm... another Timer and custom code perhaps. At the same time I realised my previous "fade away" animation wasn't working to well when a user tried multiple deletes - deleting one before the previous had fully faded.</P>
<P>Obviously creating a separate Timer instance for every animatable object isn't going to be very efficient in terms of costly timer resources. Hence the birth of the Transition and TransitionManager classes.</P><A href="http://11011.net/software/vspaste"></A>
<P><A href="http://blog.spencen.com/images/83489-72989/Spencen.Drawing_4.png" target=_blank><IMG style="BORDER-RIGHT-WIDTH: 0px; BORDER-TOP-WIDTH: 0px; BORDER-BOTTOM-WIDTH: 0px; BORDER-LEFT-WIDTH: 0px" border=0 alt=Spencen.Drawing src="http://blog.spencen.com/images/83489-72989/Spencen.Drawing_thumb_1.png" width=640 height=253></A> </P>
<P>This class allows <STRONG>simple</STRONG> animations to be performed with very minimal code in a WinForms application. The TransitionManager internally uses a BackgroundWorker to perform the animation - bubbling an event up whenever a transition step occurs so that the UI can redraw. The thing to note with all of this is that it will only work with classes that derive from GraphicsObject. Within PhotoPlay this is the individual photos - but it can be any regular or irregular shaped graphic.</P>
<P>Typically the UI will consist of a number of graphical elements that require GDI+ rendering and hence these could be stored in a "shapes" collection and rendered in OnPaint.</P><PRE class=code>        <SPAN style="COLOR: rgb(0,0,255)">protected</SPAN> <SPAN style="COLOR: rgb(0,0,255)">override</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> OnPaint(<SPAN style="COLOR: rgb(43,145,175)">PaintEventArgs</SPAN> e)        {            <SPAN style="COLOR: rgb(0,0,255)">base</SPAN>.OnPaint(e);            <SPAN style="COLOR: rgb(0,0,255)">foreach</SPAN> (<SPAN style="COLOR: rgb(43,145,175)">GraphicsObject</SPAN> graphicsObject <SPAN style="COLOR: rgb(0,0,255)">in</SPAN> shapes)            {                graphicsObject.Paint(e.Graphics);            }        }</PRE>
<P>To animate these objects its as simple as something like the following (although you may prefer slightly less randomness in your own applications <IMG border=0 src="http://blog.spencen.com/emoticons/smile.png">).</P><PRE class=code>        <SPAN style="COLOR: rgb(0,0,255)">private</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> animateButton_Click(<SPAN style="COLOR: rgb(0,0,255)">object</SPAN> sender, <SPAN style="COLOR: rgb(43,145,175)">EventArgs</SPAN> e)        {            <SPAN style="COLOR: rgb(43,145,175)">Random</SPAN> randomizer = <SPAN style="COLOR: rgb(0,0,255)">new</SPAN> <SPAN style="COLOR: rgb(43,145,175)">Random</SPAN>();            <SPAN style="COLOR: rgb(0,0,255)">foreach</SPAN> (<SPAN style="COLOR: rgb(43,145,175)">GraphicsObject</SPAN> graphicsObject <SPAN style="COLOR: rgb(0,0,255)">in</SPAN> shapes)            {                <SPAN style="COLOR: rgb(43,145,175)">Transition</SPAN> transition = <SPAN style="COLOR: rgb(0,0,255)">new</SPAN> <SPAN style="COLOR: rgb(43,145,175)">Transition</SPAN>(graphicsObject,                    randomizer.Next(1000) + 200,                    randomizer.Next(360),                    randomizer.Next(5) + 1,                    <SPAN style="COLOR: rgb(0,0,255)">new</SPAN> <SPAN style="COLOR: rgb(43,145,175)">PointF</SPAN>(randomizer.Next(400) + 50, randomizer.Next(400) + 50),                    randomizer.Next(50) / 100.0f + 0.5f);                transitionManager.Add(transition);            }            transitionManager.Start();        }        <SPAN style="COLOR: rgb(0,0,255)">private</SPAN> <SPAN style="COLOR: rgb(0,0,255)">void</SPAN> transitionManager_TransitionStep(<SPAN style="COLOR: rgb(0,0,255)">object</SPAN> sender, <SPAN style="COLOR: rgb(43,145,175)">TransitonStepEventArgs</SPAN> e)        {            <SPAN style="COLOR: rgb(0,128,0)">// A transition has occurred so force a redraw. Would be better if we added</SPAN>            <SPAN style="COLOR: rgb(0,128,0)">// Bounds to GraphicsObject so we could do Invalidate(e.Transition.Target.Bounds);</SPAN>            Invalidate();        }</PRE><A href="http://11011.net/software/vspaste"></A>
<P>Here's a <A href="https://www.spencen.com/install/WinFormsTransitions/publish.htm" target=_blank>ClickOnce online sample</A> and here's the <A href="http://www.spencen.com/source/WinFormsTransitions.zip">zipped source code for it</A>.</P>
<P><A href="http://blog.spencen.com/images/83489-72989/WinFormsTransitions_2.png" target=_blank><IMG style="BORDER-BOTTOM: 0px; BORDER-LEFT: 0px; BORDER-TOP: 0px; BORDER-RIGHT: 0px" border=0 alt="Windows Forms Transition Manager Screenshot" src="http://blog.spencen.com/images/83489-72989/WinFormsTransitions_thumb.png" width=400 height=333></A> </P>
<P>Roll on WPF and Storyboard double buffer animations <IMG border=0 src="http://blog.spencen.com/emoticons/smile.png"><BR><BR><BR>[<SPAN style="COLOR: #ff0000"><STRONG>UPDATE</STRONG></SPAN>: For those looking for a more fully featured transition/animation library for WinForms I suggest you take a look at Richard's offering up at <A href="http://code.google.com/p/dot-net-transitions">http://code.google.com/p/dot-net-transitions</A>. ]</P>

